/*! ZipZap 2015-06-08 */
!function(a,b){"use strict";var c={},d=c,e={},f=e;e.statics={appName:"ZipZap",difficult:3,hideClass:"hide",invisibleClass:"invisible",app:{wrapperClass:"app-wrapper",headerClass:"app-header",gameContainerClass:"game-container",difficultyChangeClass:"app-difficulty",difficultyNumberClass:"app-difficulty-num"},modal:{mainClass:"app-modal",closeButtonClass:"app-modal-close-btn",containerClass:"app-modal-container",titleFieldClass:"app-modal-title",contentFieldClass:"app-modal-content",footerClass:"app-modal-footer",defaultBtnClass:"app-modal-default-btn",hideClass:"hidden"},boxClass:"app-box",boxPointerClass:"app-box-pointer",boxWrapperClass:"app-box-wrapper",boxMovingClass:"app-box-moving",matrixWrapperClass:"matrix-wrap",counterClass:"moviments"},e.data={},c.init=function(){console.log("Initializing ConfigurationModule"),d.set("difficulty",3)},c.isMobile=function(a){var b=/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/;return b.test(a)}(window.navigator.userAgent),c.EventType=function(){var a=d.isMobile;return{touchstart:a?"touchstart":"mousedown",touchmove:a?"touchmove":"mousemove",touchend:a?"touchend":"mouseup"}}(),c.translateEventPosition=function(a){if(d.isMobile){var b;return b=a.touches.length?a.touches[0]:a.changedTouches.length?a.changedTouches[0]:a.targetTouches.length?a.targetTouches[0]:{clientX:0,clientY:0},{x:b.clientX,y:b.clientY}}return{x:a.pageX,y:a.pageY}},c.getStatic=function(a){return f.get(a,f.statics)},c.get=function(a,b){return f.get(a,f.data,b)},c.set=function(a,b,c,d){if(!a)return!1;var e=f.data,g=b;return"string"==typeof c&&(g={value:b,hash:c}),e.hasOwnProperty(a)&&"boolean"==typeof c&&c?e[a].hash&&e[a].hash===d?(e[a]=g,!0):e[a].hash?!1:(e[a]=g,!0):e.hasOwnProperty(a)?!1:(e[a]=g,!0)},c.getWindowBounds=function(a){var b="."+f.statics.app.headerClass,c=document.querySelector(b).offsetHeight;return{width:window.innerWidth,height:a?window.innerHeight:window.innerHeight-c}},c.resolveAppBounds=function(){var a=d.getWindowBounds();return a.width==a.height?a.width:a.width>a.height?a.height:a.width},e.get=function(a,b,c){if(!b.hasOwnProperty(a))return null;var d=b[a].hash;return d&&c?d!==c?null:b[a].value:b[a]},a.cfg=c}(this.zipzap=this.zipzap||{}),function(a,b){"use strict";var c=a.cfg,d={},e=d,f={},g=f,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=[],r=null,s={modal:{hasTitleField:!0,hasCloseButton:!0,closeOnOverlay:!0},alert:{hasCloseButton:!1},confirm:{hasCloseButton:!1,confirmMessage:"Sim",declineMessage:"Não"}},t=!1;d.init=function(a){if(t)throw new Error("Modal Module already initialized.");console.log("Initializing ModalModule");var b=c.getStatic("modal"),d=b.mainClass,e=b.closeButtonClass,f=b.containerClass,h=b.titleFieldClass,i=b.footerClass,j=b.contentFieldClass;n=b.defaultBtnClass,p=b.hideClass,o=c.getStatic("hideClass"),g.registerDOMElements({modal:d,closeButton:e,container:f,title:h,content:j,footer:i}),a&&a.template?g.changeToTemplate(a.template):g.setModal(),t=!0},d.show=function(){return h.classList.remove(p),g.addEvents(),d},d.hide=function(a){return"confirm"!=r?(g.hide(a),d):void 0},d.reset=function(){return g.clearTemplate(),d},d.isVisible=function(){return!h.classList.contains(p)},d.changeToTemplate=function(a,b){if("modal"==a)return g.setModal(b);if("alert"==a)return g.setAlert(b);if("confirm"==a)return g.setConfirm(b);if(g.getCustomTemplate(a))return g.setCustomTemplate(a,b);throw new Error("Template not found.")},d.addCustomTemplate=function(a,b){if(!a||!b)throw new Error("You forgot some params to create a custom template.")},d.setContent=function(a){if(!r)throw new Error("You have to set a template before setting the content.");return"modal"==r?g.setContentModal(a):"alert"==r?g.setContentAlert(a):"confirm"==r?g.setContentConfirm(a):g.setContentCustomTemplate(a)},f.addEvents=function(){document.addEventListener("keydown",g.hideOnEsc)},f.removeEvents=function(){document.removeEventListener("keydown",g.hideOnEsc)},f.hideOnEsc=function(a){27!==a.keyCode||g.hasCloseButton()||g.hide()},f.hasCloseButton=function(){return i.classList.contains(o)},f.registerDOMElements=function(a){if(!(a&&a.modal&&a.closeButton&&a.container&&a.content&&a.title&&a.footer))throw new Error("To register the modal you have to specify all the HTMLDOMElements.");h=document.querySelector("."+a.modal),i=document.querySelector("."+a.closeButton),j=document.querySelector("."+a.container),l=document.querySelector("."+a.content),k=document.querySelector("."+a.title),m=document.querySelector("."+a.footer)},f.hide=function(a){a&&a.preventDefault&&a.preventDefault(),h.classList.add(p),g.removeEvents()},f.clearTemplate=function(a){var b=h.classList;r=null,[].forEach.call(b,function(a,b){h.classList.remove(a)}),a&&a.hide&&e.hide(),b.add(c.getStatic("modal").mainClass),m.innerHTML="",l.innerHTML="",k.innerHTML=""},f.setModal=function(a){return g.clearTemplate({hide:!e.isVisible()}),!a||a.showCloseButton||s.modal.hasCloseButton?g.showCloseButton():g.hideCloseButton(),a&&g.setContentModal(a),r="modal",d},f.setAlert=function(a){return g.clearTemplate({hide:!e.isVisible()}),!a||a.showCloseButton||s.alert.hasCloseButton?g.showCloseButton():g.hideCloseButton(),h.classList.add("alert-template"),a&&g.setContentAlert(a),r="alert",d},f.setConfirm=function(a){return g.clearTemplate({hide:!e.isVisible()}),!a||a.showCloseButton||s.confirm.hasCloseButton?g.showCloseButton():g.hideCloseButton(),h.classList.add("confirm-template"),a&&g.setContentConfirm(a),r="confirm",d},f.setCustomTemplate=function(a,b){},f.hideCloseButton=function(){i.classList.add(o),g.removeCloseEvent()},f.showCloseButton=function(){i.classList.remove(o),g.addCloseEvent()},f.addCloseEvent=function(a){i=a||i,i.addEventListener(c.EventType.touchstart,e.hide)},f.removeCloseEvent=function(a){i=a||i,i.removeEventListener(c.EventType.touchstart,e.hide)},f.getCustomTemplate=function(a){if(!a)return null;for(var b=0,c=q.length;c>b;b++)if(q[b].name==a)return q[b];return null},f.setContentModal=function(a){return a.content&&(l.innerHTML=a.content),a.title&&(k.innerHTML=a.title),g.configFooter({hide:!0}),d},f.setContentAlert=function(a){a.content&&(l.innerHTML=a.content),a.title&&(k.innerHTML=a.title);var b=[e.hide];return a.btnCallback&&b.push(a.btnCallback),g.configFooter({hide:!1,buttons:[{color:"blue",text:a.btnText,clicks:b}]}),d},f.setContentConfirm=function(a){function b(){g.hide(),a.confirmCallback&&a.confirmCallback()}function c(){g.hide(),a.declineCallback&&a.declineCallback()}a.title&&(k.innerHTML=a.title),a.content&&(l.innerHTML=a.content);var e=a.btnConfirmMessage?a.btnConfirmMessage:s.confirm.confirmMessage,f=a.btnDeclineMessage?a.btnDeclineMessage:s.confirm.declineMessage;return g.configFooter({hide:!1,buttons:[{color:a.btnConfirmColor||"blue",text:e,clicks:b},{color:a.btnDeclineColor||"red",text:f,clicks:c}]}),d},f.setContentCustomTemplate=function(a){},f.configFooter=function(a){if(m.innerHTML="",a.hide?m.classList.add("hide"):m.classList.remove("hide"),a.buttons)for(var b,d=a.buttons.length,e=0;d>e;e++){var f=document.createElement("button");if(f.innerText=a.buttons[e].text,f.classList.add(n),f.classList.add(a.buttons[e].color),b=a.buttons[e].clicks,"Array"===b.constructor.name&&b.length)for(var g=a.buttons[e].clicks.length-1;g>=0;g--)f.addEventListener(c.EventType.touchstart,a.buttons[e].clicks[g]);else f.addEventListener(c.EventType.touchstart,a.buttons[e].clicks);m.appendChild(f)}},a.modal=d}(this.zipzap=this.zipzap||{}),function(a,b){"use strict";var c=a.cfg,d=a.modal,e=(a.setup,null),f=null,g=null,h=null,i=null,j=null,k={},l={},m=l,n={},o=n;k.init=function(a){console.log("Initializing AppModule"),f=c.get("difficulty"),g=document.querySelector("."+c.getStatic("matrixWrapperClass")),h=document.querySelector("."+c.getStatic("app").headerClass),i=document.querySelector("."+c.getStatic("app").wrapperClass),j=Math.floor((new Date).getTime()*Math.random()*2).toString(),g&&m.prepareMatrix()},l.prepareMatrix=function(){e=new Array(f);for(var a=0;f>a;a+=1)e[a]=[];m.startGame()},l.startGame=function(){m.resetDifficultyBanner(),m.moviments("reset"),m.makeMatrix(),m.draw()},l.makeMatrix=function(){var a,b,c,d,g,h=[],i=f*f;for(d=0;i>d;d+=1)a=Math.floor(d/f),b=d%f,c={row:a,col:b,observer:l},g=Math.ceil(Math.random()*i)-1,-1===h.indexOf(g)?(h.push(g),c.value=g,0===g&&(c.pointer=!0),e[a][b]=o.Box(c)):d-=1},l.draw=function(){var a=document.createDocumentFragment();m.each(function(b){var d=document.createElement("div");d.classList.add(c.getStatic("boxWrapperClass")),d.appendChild(b.e),a.appendChild(d)}),g.innerHTML="",g.appendChild(a),i.classList.remove(c.getStatic("invisibleClass"))},l.each=function(a){for(var b=0;f>b;b+=1)for(var c=0;f>c;c+=1)a(e[b][c])},l.notify=function(a){m.each(function(b){b.inRangeOf(a)&&m.changePosition(b,a)})},l.changePosition=function(a,b){if(m.areNeighbors(a,b)){var c=Object.create(e[a.row][a.col]);e[a.row][a.col]=b,e[b.row][b.col]=c,c.row=b.row,c.col=b.col,b.row=a.row,b.col=a.col,m.moviments("add"),m.draw(),m.checkState()}},l.checkState=function(){var a,b,c,d,g=0;for(a=0;f>a;a++)for(b=0;f>b;b++){if(c=e[a][b],d=c.value?c.value:f*f,!(d>g))return;g=d}m.endGame()},l.endGame=function(){d.changeToTemplate("confirm",{title:"Parabéns!",content:"Você terminou o jogo com <strong>"+c.get("moviments",j)+" movimentos</strong> no <strong>nível "+(f-2)+"</strong>.",btnConfirmMessage:"Jogar novamente",confirmCallback:m.startGame,btnDeclineMessage:"Mudar dificuldade",btnDeclineColor:"green",declineCallback:m.changeDifficulty}).show()},l.changeDifficulty=function(){zipzap.setup&&zipzap.setup.changeDifficulty&&zipzap.setup.changeDifficulty()},l.areNeighbors=function(a,b){return m.checkNeighborhood(a,b)||m.checkNeighborhood(b,a)},l.checkNeighborhood=function(a,b){var c=a.col==b.col-1||a.col==b.col+1,d=a.row==b.row,e=a.row==b.row-1||a.row==b.row+1,f=a.col==b.col;return c&&d||e&&f},l.moviments=function(a,b){var d=document.querySelector("."+c.getStatic("counterClass")),e=c.get("moviments",j);switch(a){case"add":e=b?e+b:e+1,d.innerText=e,c.set("moviments",e,!0,j);break;case"reset":c.set("moviments",0,!0,j),d.innerText=0}},l.resetDifficultyBanner=function(){var a=c.getStatic("app").difficultyNumberClass,b=document.querySelector("."+a);b.innerText=f-2},n.Box=function p(a){return this instanceof p?(this.e=document.createElement("div"),this.row=a.row,this.col=a.col,this.observer=a.observer,this.target=null,this.pointer=a.pointer||!1,this.value=isNaN(a.value)?null:a.value,void this.init()):new n.Box(a)},n.Box.prototype={dif:null,touchStart:null,touchMove:null,touchEnd:null,init:function(){this.setupStyle(),this.setupContent(),this.touchMove=this.onTouchMove.bind(this),this.touchEnd=this.onTouchEnd.bind(this),this.touchStart=this.onTouchStart.bind(this),!this.pointer&&this.addStartEvent()},setupStyle:function(){var a=this.e.classList;a.add(c.getStatic("boxClass")),this.pointer&&a.add(c.getStatic("boxPointerClass"))},setupContent:function(){this.e.innerHTML=this.value},getPosition:function(){return{x:parseFloat(this.e.offsetLeft),y:parseFloat(this.e.offsetTop)}},getBounds:function(){return{width:this.e.offsetWidth,height:this.e.offsetHeight}},addStartEvent:function(){this.e.addEventListener(c.EventType.touchstart,this.touchStart)},addMovingEvents:function(){document.addEventListener(c.EventType.touchmove,this.touchMove),document.addEventListener(c.EventType.touchend,this.touchEnd)},removeEvents:function(){document.removeEventListener(c.EventType.touchmove,this.touchMove),document.removeEventListener(c.EventType.touchend,this.touchEnd)},onTouchStart:function(a){var b=c.translateEventPosition(a),d=this.getPosition();a.preventDefault(),this.dif={x:b.x-d.x,y:b.y-d.y},this.e.classList.add(c.getStatic("boxMovingClass")),this.addMovingEvents()},onTouchMove:function(a){var b=c.translateEventPosition(a),d=this.e.style;a.preventDefault(),d.top=b.y-this.dif.y+"px",d.left=b.x-this.dif.x+"px"},onTouchEnd:function(a){var b=c.translateEventPosition(a),d=this.e.style;a.preventDefault(),this.target={x:parseInt(b.x),y:parseInt(b.y)},this.e.classList.remove(c.getStatic("boxMovingClass")),d.top="",d.left="",this.removeEvents(),this.observer.notify(this)},inRangeOf:function(a){return this.inMyRange(a)&&this.pointer},inMyRange:function(a){var b=a.target,c=this.getPosition(),d=this.getBounds(),e=c.x<=b.x&&b.x<=c.x+d.width,f=c.y<=b.y&&b.y<=c.y+d.height;return e&&f}},a.app=k}(this.zipzap=this.zipzap||{}),function(a,b){"use strict";var c=a.cfg,d=a.modal,e=a.app,f={},g=f,h={},i=h,j=!0,k=null,l=null;g.done=!1,f.init=function(){console.log("Initializing SetupModule"),i.prepare(),j?i.initUserSetup():i.configDifficulty()},f.changeDifficulty=function(){k=c.get("difficulty"),i.configDifficulty({title:"Modificar dificuldade",showCloseButton:!0})},h.prepare=function(){var a=localStorage.getItem("tutorial");a&&(j=!1),l=c.resolveAppBounds()/40-2},h.setupEvents=function(){var a="."+c.getStatic("app").difficultyChangeClass,b=document.querySelector(a);b.addEventListener(c.EventType.touchstart,g.changeDifficulty)},h.configBoundsAndStyles=function(){var a=c.get("difficulty"),b=c.resolveAppBounds(),d="."+c.getStatic("app").wrapperClass,e="."+c.getStatic("boxWrapperClass"),f="."+c.getStatic("boxClass"),g="."+c.getStatic("boxPointerClass"),h=b/a,i=h/2.5>32?32:h/2.5,j=document.querySelector("style")||document.createElement("style"),k=2,l="";l+=d+"{width: "+b+"px;}",l+=e+"{width: "+h+"px;height: "+h+"px;padding: 1px}",l+=f+", "+g+"{width: "+(h-k)+"px;height: "+(h-k)+"px;font-size: "+i+"px;line-height: "+(h-k)+"px;}",j.appendChild(document.createTextNode(l)),document.head.appendChild(j)},h.initUserSetup=function(){d.changeToTemplate("confirm",{title:"Bem vindo ao ZipZap!",content:"<strong>ZipZap</strong> é um simples jogo de ordenação de números.<br><br>Quer saber mais sobre o jogo e até <strong>configurá-lo</strong>?",btnConfirmMessage:"Sim",btnDeclineMessage:"Não",confirmCallback:i.showTutorial,declineCallback:i.finishSetup}).show()},h.showTutorial=function(){d.setContent({title:"Bem vindo ao ZipZap!",content:"Seu objetivo será movimentar todos os <strong>tiles</strong> (quadrados) de maneira que fiquem <strong>ordenados</strong> a partir da esquerda para a direita, linha por linha. O tile <strong>curinga</strong> deve ficar no canto inferior direito.<br><br>Você ainda pode escolher o <strong>nível de dificuldade</strong> que deseja jogar. Por padrão, o jogo começa no primeiro nível de dificuldade, com um 9 tiles. Deseja modificar a dificuldade?",btnConfirmMessage:"Sim",btnDeclineMessage:"Não, quero jogar!",confirmCallback:i.configDifficulty,declineCallback:i.finishSetup}).show()},h.configDifficulty=function(a){for(var b="",c=2;l>c;c++)b+='<option value="'+c+'">Nível '+c+"</option>";d.changeToTemplate("alert",{title:a&&a.title?a.title:"Dificuldade",showCloseButton:a&&a.showCloseButton?a.showCloseButton:!1,content:'Por favor, selecione o nível de dificuldade que deseja jogar: <br><br><select class="app-difficulty-select"><option value="1" selected>Nível 1</option>'+b+"</select>",btnText:"Jogar!",btnCallback:i.setDifficulty}).show()},h.setDifficulty=function(){var a=document.querySelector(".app-difficulty-select"),b=Number(a.value)+2;c.set("difficulty",b,!0),localStorage.setItem("tutorial",!0),i.finishSetup()},h.finishSetup=function(){d.reset().hide(),k&&k===c.get("difficulty")||i.configBoundsAndStyles(),e.init(),i.setupEvents()},a.setup=f}(this.zipzap=this.zipzap||{}),function(a,b){"use strict";var c=a.modal,d=a.cfg,e=a.setup,f=(a.app,{}),g={},h=g;g.init=function(){d.init(),c.init(),e.init(),h.setupEvents()},g.setupEvents=function(){window.addEventListener("load",h.onWindowLoad)},g.onWindowLoad=function(){console.log("Window loaded event on LoadModule")},a.load=f,h.init()}(this.zipzap=this.zipzap||{});